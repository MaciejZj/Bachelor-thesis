\section{Proces pomiarowy i~budowa zbioru danych} \label{sec:meas}
Zgodnie z~opisem technik termowizyjnych przedstawionym w~sekcji
\ref{sec:thermovision} zdecydowano się na przeprowadzenie pomiarów za pomocą
termowizji aktywnej.
Aby zrealizować pomiary uprzednio przygotowano stanowisko laboratoryjne.
Kamera termowizyjna została umieszczona na statywie, a~do ogrzewania próbek
zdecydowano się wykorzystać lampę halogenową.

W~procesie termowizji aktywnej istotna jest charakter procesu nagrzewania
materiału.
Przy przygotowaniu pomiarów należało zdecydować przy jakim warunku zakończyć
przekazywanie ciepła do próbki.
Rozważono dwie możliwości:
\begin{enumerate}[a)]
	\item ogrzewanie próbek do osiągnięcia ustalonej temperatury,
	\item \label{it:heatmethod} ogrzewanie próbek przez określony, stały czas.
\end{enumerate}
Zdecydowano się na metodę \ref{it:heatmethod}, ze względu na wygodę jej
realizacji.
Doprowadzenie każdej próbki do tej samej temperatury wymagałoby pomiarów
w~czasie nagrzewania, co jest bardziej wymagające do realizacji.
Zgodnie ze wstępnymi obserwacjami nagrzewanie materiału przez określony
czas pozwala na obserwację jego cech unikalnych i~wzorców zachowania podczas
stygnięcia.
Następnie należy wybrać czas nagrywania materiałów wideo kamerą.
Na podstawie wstępnych obserwacji i~próbnych nagrań zdecydowano się na
ogrzewanie próbek przez jedną minutę oraz rejestrację ich stygnięcia przez
cztery minuty.
Taka konfiguracja daje przy badanych pyłach rud miedzi ostry i~szczegółowy
obraz w~początkowej fazie nagrywania oraz widocznie rozmazany i~mniej
kontrastowy materiał pod koniec stygnięcia próbek.
Charakter procesu przejścia między tymi stanami pozwoli na klasyfikację
badanych próbek.
Ostatnia decyzja kształtująca charakter pomiarów dotyczy chwili
przechwytywania stopklatek z~pozyskanych materiałów wideo.
Na podstawie obserwacji zdecydowano się eksportować 5 klatek na początku
każdej minuty nagrania.
Po ustaleniu planu eksperymentu pomiarowego przystąpiono do jego wykonania.
Zgodnie z~opisem badanych materiałów w~sekcji \ref{sec:grains}, zgromadzono
materiały wideo dla czterech klas ziaren rudy miedzi.
Ze względu na czasochłonność pomiarów dla każdej klasy materiału nagrano trzy
materiały wideo.
Z~pozyskanych nagrań wyeksportowano stopklatki używając programu FLIR Tools,
pamiętając o~używaniu algorytmu automatycznego doboru zakresu temperatur
zgodnie z~opisem w~podsekcji \ref{subsec:camsoft}.

% TODO: Potem można tu wspomnieć że są wnioski na temat rozmiaru.

\section{Analiza zebranych obrazów termowizyjnych}
Zgodnie z~zamysłem pomiarów przedstawionym w~sekcji \ref{sec:meas} z~każdego
nagrania wybrano pięć stopklatek.
Podczas eksperymentu uzyskano łącznie dwanaście pomiarów, zawierających
sumarycznie 60 zdjęć.
W~ramach uczenia maszynowego jest to bardzo mały zbiór danych, biorąc jednak
pod uwagę wstępno-badawczy charakter pracy oraz czasochłonność procesu 
pomiarowego zdecydowano, że jest to rozmiar zadawalający do pierwszych
prób klasyfikacji.
% TODO: może przenieść do glosariusza
Zebrane materiały mają format JPEG, do oznaczania zdjęć przyjęto schemat
nazw jak w~przykładzie: 115\_E11R\_1, gdzie człony nazwy oznaczają kolejno:
\begin{itemize}
	\item automatyczny numer nagrania w~programie FLIR Tools,
	\item klasę próbki,
	\item minutę nagrania.
\end{itemize}

\subsection{Prezentacja przykładowej serii pomiarowej}
Jak opisano w rozdziale \ref{sec:meas} jedna próbka w~zbiorze danych 
składa się z~serii pięciu zdjęć o~malejącym kontraście i~szczegółowości.
Na rysunku \ref{fig:sample} przedstawiono przykładową próbkę 104 klasy E5R.
Widoczny jest proces stygnięcia materiału.
Skala po prawej stronie obrazów ma malejące na kolejnych obrazach wartości
co pokazuje że następuje zmniejszenie temperatury na całym obrazie.
Dodatkowo obraz staje się coraz mniej wyraźny i~kontrastowy.
Ze względu na budowę materiału nagrzana próbka emituje ciepłoze swoich
zróżnicowanych struktur w~niejednorodny sposób.
Wraz z~ochłodzeniem próbki jej temperatura się wyrównuje i~kamera termowizyjna
rejestruje coraz mniej szczegółów.
Detale i~elementy charakterystyczne obrazu zlewają się na kolejnych zdjęciach,
wraz z~opadaniem temperatury na zdjęciu pojawia się także coraz więcej szumów.
\begin{figure}[htbp]
	\centering
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[width=\textwidth]{sample/104_E5R_0}
		\caption{Obraz z~próbki 104\_E5R\_0}
	\end{subfigure}
	\hspace{0.75cm}
	\vspace{0.5cm}
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[width=\textwidth]{sample/104_E5R_1}
		\caption{Obraz z~próbki 104\_E5R\_1}
	\end{subfigure}
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[width=\textwidth]{sample/104_E5R_2}
		\caption{Obraz z~próbki 104\_E5R\_2}
	\end{subfigure}
	\hspace{0.75cm}
	\vspace{0.5cm}
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[width=\textwidth]{sample/104_E5R_3}
		\caption{Obraz z~próbki 104\_E5R\_3}
	\end{subfigure}
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[width=\textwidth]{sample/104_E5R_4}
		\caption{Obraz z~próbki 104\_E5R\_4}
	\end{subfigure}
	\caption{Zdjęcia procesu stygnięcia w~przykładowej próbce 104 klasy E5R}
	\label{fig:sample}
\end{figure}

\subsection{Przetwarzanie danych wizyjnych}

\subsection{Poprawa jakości obrazu}

\subsection{Automatyczny odczyt zakresu pomiarowego temperatur z~obrazu}
Jak wspomniano w~sekcji \ref{subsec:camsoft} jednym z~kluczowych czynników
decydujących o~wyglądzie obrazów pochodzących z~kamery jest zakres temperatur
mapowany na kolory w~obrazie.
Niestety aplikacja FLIR Tools nie pozwala na eksport zakresu temperatur wraz
ze zdjęciami w~formie liczbowej.
W~czasie zapisu zdjęć oprogramowanie dodaje na nich interfejs z~aktywną skalą
pomiarową, jednak jest on graficznie naniesiony na obraz.
Aby ułatwić w przyszłości pracę z~materiałami z~kamery opracowano dodatkowo
mechanizm ekstrakcji zakresu temperatur z~zdjęć pochodzących z kamery.

W~celu konstrukcji funkcji odczytu wartości liczbowych z~obrazu posłużono
się gotową siecią neuronową zaprojektowaną do detekcji tekstu na zdjęciach.
Zdecydowano się na użycie popularnej biblioteki \emph{Pytesseract}.
Aby poprawnie odczytać wartości z~obrazu najpierw przycięto je tak by w~kadrze
znajdowała się tylko odczytywana liczba.
Ponieważ przy eksporcie zdjęć program FLIR Tools nakłada interfejs na zdjęcia
w~identyczny sposób, kadrowanie obrazu jest takie same dla każdej próbki
pomiarowej.
Wycięte kadry są bardzo małej rozdzielczości, aby ułatwić sieci rozpoznawanie
liczb zdecydowano się przeskalować je w~górę.
W~czasie skalowania włączono mechanizm anty aliasingu aby wyrównać krawędzie
cyfr.
Ponieważ używana sieć uznaje za tło kolor biały oraz poszukuje liczb w~kolorze
czarnym barwy na zdjęciu odwrócono.
Następnie obraz poddano binaryzacji metodą \emph{otsu}.
Jest to popularna i~wydajna metoda binaryzacji, jej efektywność jest
maksymalna kiedy ilość pikseli tła oraz pierwszego planu jest zbliżona,
dlatego poprawne kadrowanie liczb sprzyja jakości ich binaryzacji\cite{sezgin}.
Na rysunku \ref{fig:temp_bounds} przedstawiono kolejne etapy przygotowania
obrazu do rozpoznania liczb.
Implementację opisanego mechanizmu odczytywania zakresu temperatur ze zdjęć
przedstawiono na listingu \ref{lst:temp_bounds}.
\begin{figure}[htbp]
	\centering
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[width=\textwidth]{temp_bounds_scale}
		\caption{Przeskalowany kadr z~liczbą}
		\label{fig:temp_bounds_scale}
	\end{subfigure}
	\hspace{0.5cm}
	\begin{subfigure}{0.45\textwidth}
		\centering
		\includegraphics[width=\textwidth]{temp_bounds_bin}
		\caption{Kadr z~liczbą po binaryzacji}
		\label{fig:temp_bounds_bin}
	\end{subfigure}
	
	\caption{Przygotowanie zakresu temperatur do odczytu przez sieć neuronową}
	\label{fig:temp_bounds}
\end{figure}

% TODO: This code might be not ready
\begin{listing}[h]
\begin{minted}{python}
def get_temperature_bounds(img, bounds=(((6, 24), (283, 318)),
                                       ((219, 236), (283, 318)))):
    '''Extract temperature values from FLIR UI on image.'''
    img = invert(img)
    temp_txt = []
    for bound in bounds:
        bound_img = img[slice(*bound[0]), slice(*bound[1])]
        bound_img = rescale(bound_img, 4, anti_aliasing=True)
        thr = threshold_otsu(bound_img)
        img_txt = bound_img > thr
        img_txt = Image.fromarray(img_txt)
        temp = pytesseract.image_to_string(img_txt)
        if temp is not '': 
            temp = float(temp)
        else:
            temp = 0
        temp_txt.append(temp)
    return temp_txt
\end{minted}
\caption{Funkcja języka Python do odczytywania zakresu temperatur ze zdjęć
         z~kamery}
\label{lst:temp_bounds}
\end{listing}


\section{Poszukiwanie zależności użytecznych w~klasyfikacji}

\subsection{Rozważane możliwości użycia cech obrazu w~klasyfikacji}

\subsection{Wybór algorytmu detekcji ziaren}

\subsection{Algorytm śledzenia ziaren w~serii zdjęć}

\subsection{Wizualizacja zebranych cech i~ocena ich użyteczności}
